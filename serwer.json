const TelegramBot = require('node-telegram-bot-api');

// UÅ¼yj zmiennej Å›rodowiskowej dla tokena
const token = process.env.TELEGRAM_TOKEN;
const bot = new TelegramBot(token, { polling: true });

// ObsÅ‚uga komendy /kasyno
bot.onText(/\/kasyno/, (msg) => {
  const chatId = msg.chat.id;
  showGameMenu(chatId);
});

// Funkcja pokazujÄ…ca menu gier
function showGameMenu(chatId) {
  const menuMessage = `
Wybierz grÄ™ wojowniku`;
  
  bot.sendMessage(chatId, menuMessage, {
    reply_markup: {
      inline_keyboard: [
        [{ text: "ðŸŽ² Kostka", callback_data: "dice" }],
        [{ text: "ðŸƒ Karty", callback_data: "cards" }],
        [{ text: "ðŸŽ° Automaty", callback_data: "slots" }],
        [{ text: "ðŸŽ¡ Ruletka", callback_data: "roulette" }],
        [{ text: "ðŸ–¤ Blackjack", callback_data: "blackjack" }],
        [{ text: "ðŸŽ² KoÅ›ci", callback_data: "yahtzee" }],
        [{ text: "ðŸŽ¯ KoÅ‚o fortuny", callback_data: "wheel_of_fortune" }],
        [{ text: "ðŸŽ« Loteria", callback_data: "lottery" }]
      ]
    }
  });
}

// Funkcje do gier
function rollDice(chatId) {
  bot.sendMessage(chatId, "ðŸŽ² Kostka rzucona...");
  setTimeout(() => {
    const result = Math.floor(Math.random() * 6) + 1;
    bot.sendMessage(chatId, `ðŸŽ² WyrzuciÅ‚eÅ›: ${result}`);
    showGameMenu(chatId);
  }, 2000); // 2 sekundy opÃ³Åºnienia
}

function drawCard(chatId) {
  bot.sendMessage(chatId, "ðŸƒ WyciÄ…gasz kartÄ™...");
  setTimeout(() => {
    const suits = ["â™ ï¸", "â™¥ï¸", "â™£ï¸", "â™¦ï¸"];
    const ranks = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"];
    const suit = suits[Math.floor(Math.random() * suits.length)];
    const rank = ranks[Math.floor(Math.random() * ranks.length)];
    bot.sendMessage(chatId, `ðŸƒ Wylosowana karta: ${rank}${suit}`);
    showGameMenu(chatId);
  }, 2000);
}

function spinRoulette(chatId) {
  const colors = ["ðŸ”´ Czerwony", "âš« Czarny", "ðŸŸ¢ Zero"];
  
  bot.sendMessage(chatId, "ðŸŽ¡ KrÄ™cimy rosyjskÄ… ruletkÄ…...");
  setTimeout(() => {
    const result = colors[Math.floor(Math.random() * colors.length)];
    bot.sendMessage(chatId, `ðŸŽ¡ Ruletka wylosowaÅ‚a: ${result}`);
    showGameMenu(chatId);
  }, 5000); // 5 sekundy opÃ³Åºnienia
}

function playSlots(chatId) {
  bot.sendMessage(chatId, "ðŸŽ° Automat uruchomiony...");
  setTimeout(() => {
    const symbols = ["ðŸ’", "ðŸ‹", "ðŸŠ", "ðŸ‰", "â­", "7ï¸âƒ£"];
    const slot1 = symbols[Math.floor(Math.random() * symbols.length)];
    const slot2 = symbols[Math.floor(Math.random() * symbols.length)];
    const slot3 = symbols[Math.floor(Math.random() * symbols.length)];
  
    const resultMessage = `ðŸŽ° Automaty:\n| ${slot1} | ${slot2} | ${slot3} |`;
    bot.sendMessage(chatId, resultMessage);
  
    if (slot1 === slot2 && slot2 === slot3) {
      bot.sendMessage(chatId, "ðŸŽ‰ Great job brachu.");
    } else {
      bot.sendMessage(chatId, "â˜  No i przejebaÅ‚eÅ› wypÅ‚atÄ™.");
    }
    showGameMenu(chatId);
  }, 3000); // 3 sekundy opÃ³Åºnienia
}

function playBlackjack(chatId) {
  bot.sendMessage(chatId, "ðŸƒ Rozdajemy karty...");
  setTimeout(() => {
    const cardValues = [2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
    const playerHand = [cardValues[Math.floor(Math.random() * cardValues.length)], cardValues[Math.floor(Math.random() * cardValues.length)]];
    const dealerHand = [cardValues[Math.floor(Math.random() * cardValues.length)], cardValues[Math.floor(Math.random() * cardValues.length)]];
    
    const playerTotal = playerHand.reduce((a, b) => a + b, 0);
    const dealerTotal = dealerHand.reduce((a, b) => a + b, 0);

    bot.sendMessage(chatId, `ðŸ–¤ Blackjack:\nTwoje karty: ${playerHand.join(", ")} (Razem: ${playerTotal})\nKarty krupiera: ${dealerHand.join(", ")} (Razem: ${dealerTotal})`);

    if (playerTotal > 21) {
      bot.sendMessage(chatId, "ðŸ’¥ Jaki noob! PrzekroczyÅ‚eÅ› 21.");
    } else if (dealerTotal > 21 || playerTotal > dealerTotal) {
      bot.sendMessage(chatId, "ðŸŽ‰ Ty spryciarzu! Masz lepszy wynik niÅ¼ krupier.");
    } else {
      bot.sendMessage(chatId, "â˜  Wyskakuj z bliczka! Krupier ma lepszy wynik.");
    }
    showGameMenu(chatId);
  }, 3000); // 3 sekundy opÃ³Åºnienia
}

function playYahtzee(chatId) {
  bot.sendMessage(chatId, "ðŸŽ² KoÅ›ci zostaÅ‚y rzucone...");
  setTimeout(() => {
    const dice = Array.from({ length: 5 }, () => Math.floor(Math.random() * 6) + 1);
    bot.sendMessage(chatId, `ðŸŽ² KoÅ›ci:\nWyrzucone liczby: ${dice.join(", ")}`);

    const counts = dice.reduce((acc, num) => { acc[num] = (acc[num] || 0) + 1; return acc; }, {});
    if (Object.values(counts).includes(5)) {
      bot.sendMessage(chatId, "5âƒ£ðŸŽ‰ Yahtzee! PiÄ™Ä‡ takich samych!");
    } else if (Object.values(counts).includes(4)) {
      bot.sendMessage(chatId, "4âƒ£ðŸŽ‰ Cztery takie same!");
    } else if (Object.values(counts).includes(3) && Object.values(counts).includes(2)) {
      bot.sendMessage(chatId, "ðŸ’¯ Full House!");
    } else {
      bot.sendMessage(chatId, "ðŸ–• Brak specjalnych ukÅ‚adÃ³w, oddawaj bliczka loserze.");
    }
    showGameMenu(chatId);
  }, 3000); // 3 sekundy opÃ³Åºnienia
}

function spinWheelOfFortune(chatId) {
  bot.sendMessage(chatId, "ðŸŽ¯ KrÄ™cimy koÅ‚em...");
  setTimeout(() => {
    const prizes = ["WygraÅ‚eÅ›-> ðŸ’°1000$", "ðŸ’Ž 500$", "WygraÅ‚eÅ›-> ðŸ€50g Marihuanki", "WygraÅ‚eÅ›-> ðŸ”–Talon na kurwe i balon", "ðŸŽ Nagroda pocieszenia-> zdechÅ‚y szcurðŸ€", "ðŸ† Chuja wygraÅ‚eÅ›", "ðŸ† Chuja wygraÅ‚eÅ›", "ðŸŽ Nagroda pocieszenia-> kredkiðŸ–", "ðŸŽ Nagroda pocieszenia-> okularyðŸ¥¸",];
    const result = prizes[Math.floor(Math.random() * prizes.length)];
    bot.sendMessage(chatId, `ðŸŽ¯ KoÅ‚o fortuny: ${result}!`);
    showGameMenu(chatId);
  }, 5000); // 5 sekundy opÃ³Åºnienia
}

function playLottery(chatId) {
  bot.sendMessage(chatId, "ðŸŽ« SzczÄ™Å›liwy numerek to...");
  setTimeout(() => {
    const winningNumber = Math.floor(Math.random() * 10) + 1;
    const userNumber = Math.floor(Math.random() * 10) + 1;

    bot.sendMessage(chatId, `ðŸŽ« Loteria:\nTwÃ³j numer: ${userNumber}\nZwyciÄ™ski numer: ${winningNumber}`);

    if (userNumber === winningNumber) {
      bot.sendMessage(chatId, "ðŸŽ‰ Gratulacje! WygraÅ‚eÅ› loteriÄ™!");
    } else {
      bot.sendMessage(chatId, "ðŸš« Nie oddam ci bliczka.");
    }
    showGameMenu(chatId);
  }, 4000); // 4 sekundy opÃ³Åºnienia
}

// ObsÅ‚uga wyboru gier przez menu
bot.on("callback_query", (query) => {
  const chatId = query.message.chat.id;
  const game = query.data;

  switch (game) {
    case "dice":
      rollDice(chatId);
      break;
    case "cards":
      drawCard(chatId);
      break;
    case "roulette":
      spinRoulette(chatId);
      break;
    case "slots":
      playSlots(chatId);
      break;
    case "blackjack":
      playBlackjack(chatId);
      break;
    case "yahtzee":
      playYahtzee(chatId);
      break;
    case "wheel_of_fortune":
      spinWheelOfFortune(chatId);
      break;
    case "lottery":
      playLottery(chatId);
      break;
    default:
      bot.sendMessage(chatId, "Nieznana gra.");
  }
});
